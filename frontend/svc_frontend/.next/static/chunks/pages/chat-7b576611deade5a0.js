(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{7722:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return s(1265)}])},4586:function(e,t,s){"use strict";var n=s(5893),a=s(7294),r=s(1163),o=s(1955);t.Z=e=>{let{mostrarBotonHome:t,mostrarCerrarSesion:s}=e,i=(0,r.useRouter)(),[c,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[x,p]=(0,a.useState)(""),[g,j]=(0,a.useState)(!1);async function f(e){try{let t=await fetch("/api/actualizarestado",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c,estado:e})});await t,t.ok&&console.log("Estado modificado con \xe9xito!")}catch(e){console.error("Error:",e)}}async function y(e){try{(await fetch("/api/borrarcuenta",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e})})).ok&&console.log("Estado modificado con \xe9xito!")}catch(e){console.error("Error:",e)}}async function b(){try{confirm("Estas seguro que quieres borrar la cuenta??")&&(y(c),alert("Cuenta borrada..."),o.Z.remove("isLoggedIn"),i.push("/"))}catch(e){console.error("Error:",e)}}return(0,a.useEffect)(()=>{(async()=>{l(await o.Z.get("username"))})()},[]),(0,n.jsx)("header",{style:{backgroundColor:"rgba(0, 80, 255, 0.5)",color:"white",paddingTop:"0.5px",paddingBottom:"0.5px",textAlign:"center",width:"100%"},children:(0,n.jsx)("nav",{children:(0,n.jsxs)("ul",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",listStyleType:"none"},children:[(0,n.jsx)("li",{id:"boton-home",children:t&&(0,n.jsxs)("button",{onClick:()=>{i.push("/")},className:"btn home",children:[" ",(0,n.jsx)("img",{src:"./images/home.png",alt:"Inicio",style:{width:"40px",height:"40px"}})]})}),(0,n.jsx)("li",{style:{display:"flex",alignItems:"center"},children:s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>{m(!h)},style:{marginRight:"40px"},children:"Nuevo Estado"}),h&&(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),f(x),p(""),m(!1)},style:{marginRight:"40px"},children:[(0,n.jsx)("input",{type:"text",value:x,onChange:e=>{p(e.target.value)},placeholder:"Introduce tu texto"}),(0,n.jsx)("button",{type:"submit",children:"âœ…"})]}),(0,n.jsx)("img",{onClick:()=>{j(!g)},src:"./images/perfil.png",alt:"Inicio",style:{width:"30px",height:"30px",marginRight:"10px",cursor:"pointer"}}),(0,n.jsxs)("span",{style:{color:"black",marginRight:"50px"},children:[(0,n.jsx)("strong",{children:c}),g&&(0,n.jsx)("small",{children:(0,n.jsx)("button",{onClick:b,className:"botonborrarcuenta",children:"Borrar cuenta"})})]}),(0,n.jsx)("button",{onClick:()=>{o.Z.remove("isLoggedIn"),i.push("/")},className:"btn cerrar",children:"Cerrar Sesi\xf3n"})]})})]})})})}},3682:function(e,t,s){"use strict";var n=s(5893);s(7294),t.Z=()=>(0,n.jsx)("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"1px",textAlign:"center",position:"fixed",bottom:0,left:0,width:"100%",boxShadow:"0px -5px 10px rgba(0, 0, 0, 0.5)"},children:(0,n.jsx)("p",{children:"\xa9 TrabajoREST [Chat ETSI v1.0.0] : Miguel \xc1ngel L\xf3pez Rodr\xedguez | F\xe9lix Vald\xe9s Medina | Juan Manuel Gonz\xe1lez Orta"})})},1265:function(e,t,s){"use strict";s.r(t);var n=s(5893),a=s(7294),r=s(4586),o=s(3682),i=s(9008),c=s.n(i),l=s(1955),d=s(1664),u=s.n(d);s(2599),t.default=()=>{let[e,t]=(0,a.useState)(""),[s,i]=(0,a.useState)([]),d=l.Z.get("username"),h=(0,a.useRef)(null),m=(0,a.useRef)(null);async function x(){try{let e=await fetch("/api/obtenermensajes",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();e.ok&&i(t)}catch(e){console.error("Error:",e)}}(0,a.useEffect)(()=>{new EventSource("/api/sse").onmessage=e=>{console.log("Received message from server:",JSON.parse(e.data))},x()},[]),(0,a.useEffect)(()=>{let e=setInterval(()=>{x()},2e3);return()=>clearInterval(e)},[]),(0,a.useEffect)(()=>{p()},[s]);let p=()=>{var e;null===(e=m.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};async function g(e){try{await fetch("/api/insertarmensaje",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Error:",e)}}let j=async()=>{if(""!==e.trim()){let s={contenido:e,nombre_usu:d,hora:f()};await g(s),t(""),x()}},f=()=>{let e=new Date,t=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),n=e.getSeconds().toString().padStart(2,"0");return"".concat(t,":").concat(s,":").concat(n)};return(0,n.jsxs)("div",{children:[(0,n.jsxs)(c(),{children:[(0,n.jsx)("title",{children:"Chat"}),(0,n.jsx)("link",{rel:"icon",href:"./images/chat.png"}),(0,n.jsx)("link",{rel:"stylesheet",href:"./styles/chat.css"})]}),(0,n.jsx)(r.Z,{mostrarBotonHome:!0,mostrarCerrarSesion:!0}),(0,n.jsx)("h1",{className:"text-center my-5 display-4 font-weight-bold text-uppercase text-secondary",children:"Chat"}),(0,n.jsx)("div",{className:"container mt-5",children:(0,n.jsxs)("div",{className:"card chat-container",ref:h,children:[(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"messages",children:[s.map((e,t)=>e.nombre_usu===d?(0,n.jsxs)("div",{className:"message sent",children:[(0,n.jsx)("p",{children:e.mensaje}),(0,n.jsx)(u(),{href:"/detallecontacto?n=".concat(d),children:(0,n.jsx)("small",{className:"text-muted",children:"T\xfa"})}),(0,n.jsxs)("small",{className:"text-muted",children:[" - ",e.hora]})]},t):(0,n.jsxs)("div",{className:"message received",children:[(0,n.jsx)("p",{children:e.mensaje}),(0,n.jsx)(u(),{href:"/detallecontacto?n=".concat(e.nombre_usu),children:(0,n.jsx)("small",{className:"text-muted",children:e.nombre_usu})}),(0,n.jsxs)("small",{className:"text-muted",children:[" - ",e.hora]})]},t)),(0,n.jsx)("div",{ref:m})]})}),(0,n.jsx)("div",{className:"card-footer",children:(0,n.jsx)("input",{type:"text",className:"form-control",placeholder:"Escribe un mensaje...",value:e,onChange:e=>t(e.target.value),onKeyPress:e=>{"Enter"===e.key&&j()}})})]})}),(0,n.jsx)(o.Z,{})]})}}},function(e){e.O(0,[916,888,774,179],function(){return e(e.s=7722)}),_N_E=e.O()}]);